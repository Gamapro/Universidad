<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Webix</title>
        <link rel="stylesheet" href="//cdn.webix.com/edge/webix.css" type="text/css"> 
        <script src="//cdn.webix.com/edge/webix.js" type="text/javascript"></script> 
    </head>
    <body>
        <h1 align='center'>Welcome to Webix!</h1><br/>
        <div id="app"></div>
        <script type="text/javascript" charset="utf-8">

            const urlBuscar = 'http://dapp.enlacenet.net:8069/buscar';

            webix.ui(
                {
                    cols:[
                        { 
                            width:300,view:'form',id:'forma',elements:[
                                {view:'text',id:'Accion',name:'Accion',hidden:true,value:''},
                                {view:'text',id:'nivel',name:'nivel',label:'Nivel'},
                                {view:'text',id:'titulo',name:'titulo',label:'Titulo',labelWidth:120, required:true},
                                {view:'combo',id:'anio',name:'anio',label:'AÃ±o',options:["1972","1994"]},
                                {view:'text',id:'votos',name:'votos',label:'Votos'},
                                {cols:[
                                    {view:'button',id:'BotonNuevo',value:'Nuevo',click:nuevo},
                                    {},
                                    {view:'button',id:'BotonGuardar',value:'Guardar',click:guardar},
                                    {view:'button',id:'BotonModificar',value:'Modificar',click:modificar,hidden:true}
                                ]},
                                {view:'button',id:'BotonBorrar',value:'Borrar',click:borrar},
                            ]
                        },
                        {
                            rows:[
                                {
                                    view:"datatable", id:'tabla', select:"row",  multiselect:true,
                                    columns:[
                                        { id:"nivel", header:"", width:50,sort:'int'},
                                        { id:"titulo", header:["Pelicula",{content:"textFilter"}], width:200,
                                            fillspace:true,sort:'string'},
                                        { id:"anio", header:"Produccion", width:80,sort:'int'},
                                        { id:"votos", header:"Votos", width:100,sort:'int'},
                                    ],
                                    url: urlBuscar
                                    // url: 'results.php',
                                }
                            ]
                        }
                    ]
                }
            );

            $$('forma').bind($$('tabla'));

            function borrar() {
                var idFilas = $$('tabla').getSelectedId(true,true);
                webix.confirm('Estas seguro de eliminar las filas: ' + idFilas).then(function(resultado){
                    if(resultado) {
                        webix.ajax().post(
                            'http://dapp.enlacenet.net:8069/borrar',
                            // 'controller.php',
                            {'Accion':'Borrar','Id':idFilas},
                            function() {
                                $$('tabla').clearAll();
                                $$('tabla').load(urlBuscar);
                                // $$('tabla').load('results.php');
                            }
                        );
                    } else {
                        webix.message('OK no borro nada...');
                    }
                });
            }

            $$('tabla').attachEvent("onAfterSelect", function(selection, preserve){
                $$('BotonModificar').show();
                $$('BotonGuardar').hide();
            });
            
            function mostrar() {
                $$('Accion').setValue('Guardar');
                if($$('forma').validate()) {
                    webix.ajax().post(
                        'http://dapp.enlacenet.net:8069/mostrar',
                        // 'controller.php',
                        $$('forma').getValues(), 
                        function() {
                            $$('tabla').clearAll();
                            $$('tabla').load(urlBuscar);
                            // $$('tabla').load('results.php');
                            $$('forma').clear();
                    });
                }	
            }

            function nuevo(){
                $$('forma').clear();
                $$('BotonModificar').hide();
                $$('BotonGuardar').show();
            }

            function modificar(){
                $$('Accion').setValue('Modificar');
                if($$('forma').validate()){
                    webix.ajax().post(
                        'http://dapp.enlacenet.net:8069/modificar',
                        // 'controller.php', 
                        $$('forma').getValues(), 
                        function () {
                            $$('tabla').clearAll();
                            $$('tabla').load(urlBuscar);
                            // $$('tabla').load('results.php');
                            $$('forma').clear();
                        }
                    );
                }
            }

            function guardar(){
                $$('Accion').setValue('Guardar');
                if($$('forma').validate()){   
                    webix.ajax().post(
                        'http://dapp.enlacenet.net:8069/guardar',
                        // 'controller.php', 
                        $$('forma').getValues(), 
                        function () {
                            $$('tabla').clearAll();
                            $$('tabla').load(urlBuscar);
                            // $$('tabla').load('results.php');
                            $$('forma').clear();
                        }
                    );
                }
            }

            function showValues(){
                var values = $$('forma').getValues();
                webix.alert(
                    JSON.stringify({values}, null,'')
                );
            }

        </script>
    </body>
</html>

